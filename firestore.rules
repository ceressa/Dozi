rules_version = '2';

/*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ğŸ¥ DOZI - FIRESTORE GÃœVENLÄ°K KURALLARI                  â•‘
â•‘                                                                              â•‘
â•‘  Bu dosya Dozi uygulamasÄ±nÄ±n tÃ¼m Firestore veri gÃ¼venliÄŸini yÃ¶netir.        â•‘
â•‘  Her kural dikkatle tasarlanmÄ±ÅŸ ve test edilmelidir.                        â•‘
â•‘                                                                              â•‘
â•‘  ğŸ“‹ Ä°Ã§indekiler:                                                             â•‘
â•‘    1. YardÄ±mcÄ± Fonksiyonlar (Helper Functions)                              â•‘
â•‘    2. KullanÄ±cÄ±lar (Users)                                                   â•‘
â•‘    3. Badi Ä°liÅŸkileri (Buddies)                                              â•‘
â•‘    4. Badi Ä°stekleri (Buddy Requests)                                        â•‘
â•‘    5. Ä°laÃ§lar (Medicines)                                                    â•‘
â•‘    6. HatÄ±rlatÄ±cÄ±lar (Reminders)                                             â•‘
â•‘    7. Ä°laÃ§ LoglarÄ± (Medication Logs)                                         â•‘
â•‘    8. Bildirimler (Notifications)                                            â•‘
â•‘    9. Aile Paketi (Family Plans)                                             â•‘
â•‘   10. KullanÄ±cÄ± Ä°statistikleri (User Stats)                                  â•‘
â•‘   11. Ban YÃ¶netimi (User Bans)                                               â•‘
â•‘   12. Analytics                                                              â•‘
â•‘                                                                              â•‘
â•‘  ğŸ”’ GÃ¼venlik Seviyesi: YÃœKSEK                                                â•‘
â•‘  âš¡ Son GÃ¼ncelleme: 2025-11-20                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/

service cloud.firestore {
  match /databases/{database}/documents {

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ› ï¸  BÃ–LÃœM 1: YARDIMCI FONKSÄ°YONLAR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Bu fonksiyonlar tÃ¼m kurallar boyunca kullanÄ±lÄ±r ve kodu daha okunabilir
    // yapar. GÃ¼venlik kontrollerini merkezileÅŸtirir.
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ ğŸ” Kimlik DoÄŸrulama Kontrolleri                                     â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    /**
     * KullanÄ±cÄ±nÄ±n giriÅŸ yapmÄ±ÅŸ olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.
     * @returns {boolean} true eÄŸer kullanÄ±cÄ± authenticated ise
     */
    function isAuthenticated() {
      return request.auth != null;
    }

    /**
     * KullanÄ±cÄ±nÄ±n belirli bir userId'ye sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.
     * @param userId - Kontrol edilecek kullanÄ±cÄ± ID'si
     * @returns {boolean} true eÄŸer giriÅŸ yapan kullanÄ±cÄ±nÄ±n ID'si eÅŸleÅŸiyorsa
     */
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ ğŸ‘¥ Badi Ä°liÅŸki Kontrolleri                                          â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    /**
     * Ä°ki kullanÄ±cÄ± arasÄ±nda aktif bir Badi iliÅŸkisinin olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.
     * Bu fonksiyon MEVCUT veriye bakar (resource.data).
     *
     * @param targetUserId - Ä°liÅŸki kontrol edilecek hedef kullanÄ±cÄ± ID'si
     * @returns {boolean} true eÄŸer aktif bir badi iliÅŸkisi varsa
     */
    function isBuddyOf(targetUserId) {
      return isAuthenticated() && exists(
        /databases/$(database)/documents/buddies/$(request.auth.uid + '_' + targetUserId)
      ) && get(
        /databases/$(database)/documents/buddies/$(request.auth.uid + '_' + targetUserId)
      ).data.status == 'ACTIVE';
    }

    /**
     * Ä°ki kullanÄ±cÄ± arasÄ±nda (herhangi yÃ¶nde) badi iliÅŸkisi olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.
     * Ã‡ift yÃ¶nlÃ¼ kontrol yapar: A->B veya B->A
     *
     * @param targetUserId - Ä°liÅŸki kontrol edilecek kullanÄ±cÄ± ID'si
     * @returns {boolean} true eÄŸer herhangi bir yÃ¶nde aktif badi iliÅŸkisi varsa
     */
    function isBuddyBidirectional(targetUserId) {
      return isBuddyOf(targetUserId) || (
        exists(/databases/$(database)/documents/buddies/$(targetUserId + '_' + request.auth.uid)) &&
        get(/databases/$(database)/documents/buddies/$(targetUserId + '_' + request.auth.uid)).data.status == 'ACTIVE'
      );
    }

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ ğŸ”‘ Badi Ä°zin Kontrolleri (Permission Checks)                        â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±nÄ±n ilaÃ§larÄ±nÄ± gÃ¶rÃ¼ntÃ¼leme izni var mÄ±?
     */
    function canViewRemindersOf(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canViewReminders == true;
    }

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±nÄ±n ilaÃ§larÄ±nÄ± "alÄ±ndÄ±" olarak iÅŸaretleme izni var mÄ±?
     */
    function canMarkAsTakenFor(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canMarkAsTaken == true;
    }

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±nÄ±n hatÄ±rlatÄ±cÄ±larÄ±nÄ± dÃ¼zenleme izni var mÄ±?
     */
    function canEditRemindersOf(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canEditReminders == true;
    }

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±ya ilaÃ§ ekleme izni var mÄ±?
     */
    function canAddMedicineFor(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canAddMedicine == true;
    }

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±nÄ±n ilacÄ±nÄ± silme izni var mÄ±?
     */
    function canDeleteMedicineOf(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canDeleteMedicine == true;
    }

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±nÄ±n ilaÃ§ geÃ§miÅŸini gÃ¶rÃ¼ntÃ¼leme izni var mÄ±?
     */
    function canViewMedicationHistoryOf(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canViewMedicationHistory == true;
    }

    /**
     * Badi'nin belirli bir kullanÄ±cÄ±nÄ±n diÄŸer badilerini yÃ¶netme izni var mÄ±?
     */
    function canManageBadisOf(targetUserId) {
      let buddyId = request.auth.uid + '_' + targetUserId;
      return isAuthenticated() &&
             exists(/databases/$(database)/documents/buddies/$(buddyId)) &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.status == 'ACTIVE' &&
             get(/databases/$(database)/documents/buddies/$(buddyId)).data.permissions.canManageBadis == true;
    }

    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    // â”‚ âœ… Veri DoÄŸrulama FonksiyonlarÄ±                                     â”‚
    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    /**
     * String alanÄ±nÄ±n boÅŸ olmadÄ±ÄŸÄ±nÄ± ve maksimum uzunluÄŸunu kontrol eder.
     *
     * @param field - Kontrol edilecek string deÄŸer
     * @param maxLength - Maksimum izin verilen uzunluk
     * @returns {boolean} true eÄŸer geÃ§erli ise
     */
    function isValidString(field, maxLength) {
      return field is string &&
             field.size() > 0 &&
             field.size() <= maxLength;
    }

    /**
     * Email formatÄ±nÄ±n geÃ§erli olup olmadÄ±ÄŸÄ±nÄ± kontrol eder.
     *
     * @param email - Kontrol edilecek email string'i
     * @returns {boolean} true eÄŸer geÃ§erli email formatÄ± ise
     */
    function isValidEmail(email) {
      return email is string &&
             email.matches('^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$');
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ‘¤ BÃ–LÃœM 2: KULLANICILAR (USERS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KullanÄ±cÄ± profil bilgilerini iÃ§erir: ad, email, profil fotoÄŸrafÄ± vb.
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - Herkes authenticated kullanÄ±cÄ±larÄ± okuyabilir (badi sistemi iÃ§in)
    //    - Sadece kendi profilini oluÅŸturabilir
    //    - Sadece kendi profilini gÃ¼ncelleyebilir
    //    - Sadece kendi profilini silebilir
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /users/{userId} {
      // ğŸ“– OKUMA: TÃ¼m giriÅŸ yapmÄ±ÅŸ kullanÄ±cÄ±lar diÄŸer kullanÄ±cÄ±larÄ± gÃ¶rebilir
      // (Badi eklemek iÃ§in gerekli)
      allow read: if isAuthenticated();

      // âœï¸ OLUÅTURMA: Sadece kendi kullanÄ±cÄ± profilini oluÅŸturabilir
      allow create: if isAuthenticated() && request.auth.uid == userId;

      // ğŸ”„ GÃœNCELLEME: Sadece kendi profilini gÃ¼ncelleyebilir
      allow update: if isOwner(userId);

      // ğŸ—‘ï¸ SÄ°LME: Sadece kendi profilini silebilir
      allow delete: if isOwner(userId);


      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ’Š Ä°LAÃ‡LAR SUBCOLLECTION (users/{userId}/medicines)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      match /medicines/{medicineId} {
        // ğŸ“– OKUMA: KullanÄ±cÄ± kendi ilaÃ§larÄ±nÄ± okuyabilir
        // NOT: Buddy permissions ÅŸimdilik devre dÄ±ÅŸÄ± - query performance iÃ§in
        allow read: if isAuthenticated() && isOwner(userId);

        // âœï¸ OLUÅTURMA: KullanÄ±cÄ± kendi ilacÄ±nÄ± ekleyebilir
        allow create: if isAuthenticated() && isOwner(userId);

        // ğŸ”„ GÃœNCELLEME: KullanÄ±cÄ± kendi ilacÄ±nÄ± gÃ¼ncelleyebilir
        allow update: if isAuthenticated() && isOwner(userId);

        // ğŸ—‘ï¸ SÄ°LME: KullanÄ±cÄ± kendi ilacÄ±nÄ± silebilir
        allow delete: if isAuthenticated() && isOwner(userId);
      }


      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // â° HATIRLATICILAR SUBCOLLECTION (users/{userId}/reminders)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      match /reminders/{reminderId} {
        // ğŸ“– OKUMA: KullanÄ±cÄ± kendi hatÄ±rlatÄ±cÄ±larÄ±nÄ± okuyabilir
        // NOT: Buddy permissions ÅŸimdilik devre dÄ±ÅŸÄ± - query performance iÃ§in
        allow read: if isAuthenticated() && isOwner(userId);

        // âœï¸ OLUÅTURMA: KullanÄ±cÄ± kendi hatÄ±rlatÄ±cÄ±sÄ±nÄ± ekleyebilir
        allow create: if isAuthenticated() && isOwner(userId);

        // ğŸ”„ GÃœNCELLEME: KullanÄ±cÄ± kendi hatÄ±rlatÄ±cÄ±sÄ±nÄ± gÃ¼ncelleyebilir
        allow update: if isAuthenticated() && isOwner(userId);

        // ğŸ—‘ï¸ SÄ°LME: KullanÄ±cÄ± kendi hatÄ±rlatÄ±cÄ±sÄ±nÄ± silebilir
        allow delete: if isAuthenticated() && isOwner(userId);
      }


      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ‘¥ PROFÄ°LLER SUBCOLLECTION (users/{userId}/profiles)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // Aile Ã¼yesi profilleri - her kullanÄ±cÄ±nÄ±n birden fazla profili olabilir
      // Premium Ã¶zellik: 1 profil Ã¼cretsiz, 2+ profil premium gerektirir
      match /profiles/{profileId} {
        // ğŸ“– OKUMA: KullanÄ±cÄ± kendi profillerini okuyabilir
        allow read: if isAuthenticated() && isOwner(userId);

        // âœï¸ OLUÅTURMA: KullanÄ±cÄ± kendi profilini ekleyebilir
        allow create: if isAuthenticated() && isOwner(userId);

        // ğŸ”„ GÃœNCELLEME: KullanÄ±cÄ± kendi profilini gÃ¼ncelleyebilir
        allow update: if isAuthenticated() && isOwner(userId);

        // ğŸ—‘ï¸ SÄ°LME: KullanÄ±cÄ± kendi profilini silebilir
        allow delete: if isAuthenticated() && isOwner(userId);
      }


      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ† BAÅARILAR SUBCOLLECTION (users/{userId}/achievements)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // KullanÄ±cÄ±nÄ±n kazandÄ±ÄŸÄ± rozetler ve baÅŸarÄ±lar
      match /achievements/{achievementId} {
        // ğŸ“– OKUMA: KullanÄ±cÄ± kendi baÅŸarÄ±larÄ±nÄ± okuyabilir
        allow read: if isAuthenticated() && isOwner(userId);

        // âœï¸ OLUÅTURMA: KullanÄ±cÄ± kendi baÅŸarÄ±sÄ±nÄ± oluÅŸturabilir
        allow create: if isAuthenticated() && isOwner(userId);

        // ğŸ”„ GÃœNCELLEME: KullanÄ±cÄ± kendi baÅŸarÄ±sÄ±nÄ± gÃ¼ncelleyebilir
        allow update: if isAuthenticated() && isOwner(userId);

        // ğŸ—‘ï¸ SÄ°LME: KullanÄ±cÄ± kendi baÅŸarÄ±sÄ±nÄ± silebilir
        allow delete: if isAuthenticated() && isOwner(userId);
      }


      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ğŸ“‹ HATIRLITMA LOGLARI SUBCOLLECTION (users/{userId}/reminderLogs)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // HatÄ±rlatma sistemi iÃ§in detaylÄ± loglar (alarm scheduled, triggered, etc.)
      match /reminderLogs/{logId} {
        // ğŸ“– OKUMA: KullanÄ±cÄ± kendi loglarÄ±nÄ± okuyabilir
        allow read: if isAuthenticated() && isOwner(userId);

        // âœï¸ OLUÅTURMA: KullanÄ±cÄ± kendi loÄŸunu oluÅŸturabilir
        allow create: if isAuthenticated() && isOwner(userId);

        // ğŸ”„ GÃœNCELLEME: KullanÄ±cÄ± kendi loÄŸunu gÃ¼ncelleyebilir
        allow update: if isAuthenticated() && isOwner(userId);

        // ğŸ—‘ï¸ SÄ°LME: KullanÄ±cÄ± kendi loÄŸunu silebilir
        allow delete: if isAuthenticated() && isOwner(userId);
      }
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ‘¥ BÃ–LÃœM 3: BADÄ° Ä°LÄ°ÅKÄ°LERÄ° (BUDDIES COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KullanÄ±cÄ±lar arasÄ± badi (buddy/yardÄ±mcÄ±) iliÅŸkilerini yÃ¶netir.
    // Her badi iÃ§in izinler (permissions) ve tercihler (preferences) saklanÄ±r.
    //
    // ğŸ“ DokÃ¼man ID FormatÄ±: "{userId}_{buddyUserId}"
    //    Ã–rnek: "user123_user456" -> user123'Ã¼n user456 ile badi iliÅŸkisi
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - Sadece iliÅŸki taraflarÄ± okuyabilir
    //    - Her ikisi de iliÅŸki oluÅŸturabilir (kabul sonrasÄ±)
    //    - Sadece iliÅŸkinin sahibi (userId) permissions gÃ¼ncelleyebilir
    //    - Her ikisi de iliÅŸkiyi silebilir
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /buddies/{buddyId} {
      // ğŸ“– OKUMA: Sadece iliÅŸkideki iki kullanÄ±cÄ± okuyabilir
      allow read: if isAuthenticated() && (
        resource.data.userId == request.auth.uid ||
        resource.data.buddyUserId == request.auth.uid
      );

      // âœï¸ OLUÅTURMA: Ä°liÅŸkinin her iki tarafÄ± da oluÅŸturabilir
      // - OluÅŸturan kiÅŸi userId veya buddyUserId olmalÄ±
      // - buddyId formatÄ± doÄŸru olmalÄ±: "userId_buddyUserId"
      // - Status baÅŸlangÄ±Ã§ta ACTIVE olmalÄ±
      // - Permissions objesi geÃ§erli olmalÄ±
      allow create: if isAuthenticated() && (
        request.resource.data.userId == request.auth.uid ||
        request.resource.data.buddyUserId == request.auth.uid
      ) &&
      buddyId == request.resource.data.userId + '_' + request.resource.data.buddyUserId &&
      request.resource.data.status in ['ACTIVE', 'PAUSED'] &&
      request.resource.data.permissions.keys().hasAll([
        'role', 'canViewReminders', 'canReceiveNotifications',
        'canMarkAsTaken', 'canEditReminders', 'canAddMedicine',
        'canDeleteMedicine', 'canViewMedicationHistory', 'canManageBadis'
      ]);

      // ğŸ”„ GÃœNCELLEME: Sadece iliÅŸkinin sahibi (userId) gÃ¼ncelleyebilir
      // - userId deÄŸiÅŸtirilemez (immutable)
      // - buddyUserId deÄŸiÅŸtirilemez (immutable)
      // - Permissions sadece userId gÃ¼ncelleyebilir
      allow update: if isAuthenticated() &&
                       resource.data.userId == request.auth.uid &&
                       request.resource.data.userId == resource.data.userId &&
                       request.resource.data.buddyUserId == resource.data.buddyUserId;

      // ğŸ—‘ï¸ SÄ°LME: Her iki taraf da iliÅŸkiyi sonlandÄ±rabilir
      allow delete: if isAuthenticated() && (
        resource.data.userId == request.auth.uid ||
        resource.data.buddyUserId == request.auth.uid
      );
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“¨ BÃ–LÃœM 4: BADÄ° Ä°STEKLERÄ° (BUDDY_REQUESTS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KullanÄ±cÄ±lar arasÄ± badi olma isteklerini yÃ¶netir.
    // Ä°stek gÃ¶nderme, kabul etme, reddetme iÅŸlemleri burada gÃ¼vence altÄ±na alÄ±nÄ±r.
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - Sadece istek taraflarÄ± okuyabilir
    //    - Sadece gÃ¶nderen kiÅŸi istek oluÅŸturabilir
    //    - Her iki taraf da isteÄŸi gÃ¼ncelleyebilir (kabul/red iÃ§in)
    //    - Sadece gÃ¶nderen kiÅŸi isteÄŸi silebilir
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /buddy_requests/{requestId} {
      // ğŸ“– OKUMA: Sadece istek gÃ¶nderen veya alan kiÅŸi okuyabilir
      allow read: if isAuthenticated() && (
        resource.data.fromUserId == request.auth.uid ||
        resource.data.toUserId == request.auth.uid
      );

      // âœï¸ OLUÅTURMA: Sadece gÃ¶nderen kiÅŸi istek oluÅŸturabilir
      // - fromUserId giriÅŸ yapan kullanÄ±cÄ± olmalÄ±
      // - toUserId farklÄ± bir kullanÄ±cÄ± olmalÄ± (kendine istek gÃ¶nderilemez)
      // - Status baÅŸlangÄ±Ã§ta PENDING olmalÄ±
      allow create: if isAuthenticated() &&
                       request.auth.uid == request.resource.data.fromUserId &&
                       request.resource.data.fromUserId != request.resource.data.toUserId &&
                       request.resource.data.status == 'PENDING';

      // ğŸ”„ GÃœNCELLEME: Ä°stek alan kiÅŸi kabul/red edebilir, gÃ¶nderen kiÅŸi iptal edebilir
      // - fromUserId deÄŸiÅŸtirilemez
      // - toUserId deÄŸiÅŸtirilemez
      // - Status PENDING'den ACCEPTED/REJECTED'a deÄŸiÅŸtirilebilir
      allow update: if isAuthenticated() && (
        resource.data.fromUserId == request.auth.uid ||
        resource.data.toUserId == request.auth.uid
      ) &&
      request.resource.data.fromUserId == resource.data.fromUserId &&
      request.resource.data.toUserId == resource.data.toUserId &&
      request.resource.data.status in ['PENDING', 'ACCEPTED', 'REJECTED'];

      // ğŸ—‘ï¸ SÄ°LME: GÃ¶nderen veya alan kiÅŸi silebilir
      allow delete: if isAuthenticated() && (
        resource.data.fromUserId == request.auth.uid ||
        resource.data.toUserId == request.auth.uid
      );
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š BÃ–LÃœM 7: Ä°LAÃ‡ LOGLARI (MEDICATION_LOGS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Ä°laÃ§ alma geÃ§miÅŸini saklar: alÄ±ndÄ±/atlandÄ±/kaÃ§Ä±rÄ±ldÄ± durumlarÄ±
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - KullanÄ±cÄ± kendi loglarÄ±nÄ± okuyabilir
    //    - Badi, canViewMedicationHistory izni varsa loglarÄ± okuyabilir âœ…
    //    - KullanÄ±cÄ± kendi loÄŸunu oluÅŸturabilir
    //    - Badi, canMarkAsTaken izni varsa log oluÅŸturabilir âœ…
    //    - KullanÄ±cÄ± kendi loÄŸunu gÃ¼ncelleyebilir
    //    - Badi, canMarkAsTaken izni varsa log gÃ¼ncelleyebilir âœ…
    //    - KullanÄ±cÄ± kendi loÄŸunu silebilir
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /medication_logs/{logId} {
      // ğŸ“– OKUMA: KullanÄ±cÄ± kendi loglarÄ±nÄ± veya badi olarak izin varsa okuyabilir
      allow read: if isAuthenticated() && (
        isOwner(resource.data.userId) ||
        canViewMedicationHistoryOf(resource.data.userId)
      );

      // âœï¸ OLUÅTURMA: KullanÄ±cÄ± kendi loÄŸunu veya badi olarak izin varsa oluÅŸturabilir
      allow create: if isAuthenticated() && (
        isOwner(request.resource.data.userId) ||
        canMarkAsTakenFor(request.resource.data.userId)
      ) &&
      request.resource.data.status in ['TAKEN', 'SKIPPED', 'MISSED'];

      // ğŸ”„ GÃœNCELLEME: KullanÄ±cÄ± kendi loÄŸunu veya badi olarak izin varsa gÃ¼ncelleyebilir
      // - userId deÄŸiÅŸtirilemez (immutable)
      // - medicineId deÄŸiÅŸtirilemez (immutable)
      // - status geÃ§erli deÄŸerlerden biri olmalÄ±
      allow update: if isAuthenticated() && (
        isOwner(resource.data.userId) ||
        canMarkAsTakenFor(resource.data.userId)
      ) &&
      request.resource.data.userId == resource.data.userId &&
      request.resource.data.medicineId == resource.data.medicineId &&
      request.resource.data.status in ['TAKEN', 'SKIPPED', 'MISSED'];

      // ğŸ—‘ï¸ SÄ°LME: Sadece kullanÄ±cÄ± kendi loÄŸunu silebilir (badiler silemez)
      allow delete: if isAuthenticated() && isOwner(resource.data.userId);
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ”” BÃ–LÃœM 8: BÄ°LDÄ°RÄ°MLER (NOTIFICATIONS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Uygulama iÃ§i bildirimleri yÃ¶netir
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - Sadece kullanÄ±cÄ± kendi bildirimlerini okuyabilir
    //    - Cloud Functions bildirim oluÅŸturabilir (system tarafÄ±ndan)
    //    - KullanÄ±cÄ± kendi bildirimini gÃ¼ncelleyebilir (okundu iÅŸareti iÃ§in)
    //    - KullanÄ±cÄ± kendi bildirimini silebilir
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /notifications/{notificationId} {
      // ğŸ“– OKUMA: Sadece bildirim sahibi okuyabilir
      allow read: if isAuthenticated() && isOwner(resource.data.userId);

      // âœï¸ OLUÅTURMA: Herkes kendi bildirimi veya Cloud Functions oluÅŸturabilir
      allow create: if isAuthenticated() && isOwner(request.resource.data.userId);

      // ğŸ”„ GÃœNCELLEME: Sadece kullanÄ±cÄ± kendi bildirimini gÃ¼ncelleyebilir
      // - userId deÄŸiÅŸtirilemez (immutable)
      // - Genellikle sadece 'read' durumu gÃ¼ncellenir
      allow update: if isAuthenticated() &&
                       isOwner(resource.data.userId) &&
                       request.resource.data.userId == resource.data.userId;

      // ğŸ—‘ï¸ SÄ°LME: Sadece kullanÄ±cÄ± kendi bildirimini silebilir
      allow delete: if isAuthenticated() && isOwner(resource.data.userId);
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ BÃ–LÃœM 9: AÄ°LE PAKETÄ° (FAMILY_PLANS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Aile paketi (Dozi Ekstra Aile) yÃ¶netimi
    // 1 organizatÃ¶r + max 3 Ã¼ye = toplam 4 kiÅŸi
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - OrganizatÃ¶r planÄ± oluÅŸturabilir, gÃ¼ncelleyebilir, silebilir
    //    - OrganizatÃ¶r ve Ã¼yeler planÄ± okuyabilir
    //    - Davet kodu ile katÄ±lÄ±m iÃ§in invitationCode kontrolÃ¼
    //    - maxMembers limiti kontrol edilir (max 3)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /family_plans/{planId} {
      // ğŸ“– GET (Document Read): OrganizatÃ¶r veya Ã¼yeler kendi planlarÄ±nÄ± okuyabilir
      allow get: if isAuthenticated() && (
        resource.data.organizerId == request.auth.uid ||
        request.auth.uid in resource.data.currentMembers
      );

      // ğŸ“‹ LIST (Query): Herkes query yapabilir (davet kodu kontrolÃ¼ iÃ§in)
      // Not: Query sonucunda sadece kendi planlarÄ± dÃ¶necek (yukarÄ±daki get kuralÄ± ile)
      allow list: if isAuthenticated();

      // âœï¸ OLUÅTURMA: OrganizatÃ¶r planÄ± oluÅŸturabilir
      // - organizerId giriÅŸ yapan kullanÄ±cÄ± olmalÄ±
      // - maxMembers 3 olmalÄ±
      // - currentMembers boÅŸ liste olmalÄ±
      // - status ACTIVE olmalÄ±
      // - invitationCode 6 karakter olmalÄ±
      allow create: if isAuthenticated() &&
                       request.auth.uid == request.resource.data.organizerId &&
                       request.resource.data.maxMembers == 3 &&
                       request.resource.data.currentMembers.size() == 0 &&
                       request.resource.data.status == 'ACTIVE' &&
                       request.resource.data.invitationCode.size() == 6;

      // ğŸ”„ GÃœNCELLEME: OrganizatÃ¶r veya Ã¼ye (kendini eklemek iÃ§in) gÃ¼ncelleyebilir
      // - organizerId deÄŸiÅŸtirilemez (immutable)
      // - maxMembers deÄŸiÅŸtirilemez (immutable)
      // - currentMembers max 3 olmalÄ±
      // - OrganizatÃ¶r tÃ¼m gÃ¼ncellemeleri yapabilir
      // - Ãœyeler sadece kendilerini currentMembers'a ekleyebilir (davet kodu ile katÄ±lÄ±m)
      allow update: if isAuthenticated() && (
        // OrganizatÃ¶r tÃ¼m gÃ¼ncellemeleri yapabilir
        (request.auth.uid == resource.data.organizerId &&
         request.resource.data.organizerId == resource.data.organizerId &&
         request.resource.data.maxMembers == resource.data.maxMembers &&
         request.resource.data.currentMembers.size() <= 3) ||
        // Ãœye kendini ekleyebilir (davet kodu kontrolÃ¼ implicit - client-side yapÄ±lmalÄ±)
        (request.auth.uid in request.resource.data.currentMembers &&
         !(request.auth.uid in resource.data.currentMembers) &&
         request.resource.data.organizerId == resource.data.organizerId &&
         request.resource.data.currentMembers.size() <= 3)
      );

      // ğŸ—‘ï¸ SÄ°LME: Sadece organizatÃ¶r silebilir
      allow delete: if isAuthenticated() &&
                       resource.data.organizerId == request.auth.uid;
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“ˆ BÃ–LÃœM 10: KULLANICI Ä°STATÄ°STÄ°KLERÄ° (USER_STATS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KullanÄ±cÄ± istatistiklerini saklar: streak, uyumluluk oranÄ±, baÅŸarÄ±lar vb.
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - Sadece kullanÄ±cÄ± kendi istatistiklerini okuyabilir
    //    - Sadece kullanÄ±cÄ± kendi istatistiklerini oluÅŸturabilir
    //    - Sadece kullanÄ±cÄ± kendi istatistiklerini gÃ¼ncelleyebilir
    //    - Sadece kullanÄ±cÄ± kendi istatistiklerini silebilir
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /user_stats/{userId} {
      // ğŸ“– OKUMA: Sadece kullanÄ±cÄ± kendi istatistiklerini okuyabilir
      allow read: if isAuthenticated() && isOwner(userId);

      // âœï¸ OLUÅTURMA: Sadece kullanÄ±cÄ± kendi istatistiklerini oluÅŸturabilir
      allow create: if isAuthenticated() && isOwner(userId);

      // ğŸ”„ GÃœNCELLEME: Sadece kullanÄ±cÄ± kendi istatistiklerini gÃ¼ncelleyebilir
      allow update: if isAuthenticated() && isOwner(userId);

      // ğŸ—‘ï¸ SÄ°LME: Sadece kullanÄ±cÄ± kendi istatistiklerini silebilir
      allow delete: if isAuthenticated() && isOwner(userId);
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸš« BÃ–LÃœM 11: BAN YÃ–NETÄ°MÄ° (USER_BANS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // KullanÄ±cÄ± ban bilgilerini saklar
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - Sadece kullanÄ±cÄ± kendi ban durumunu okuyabilir
    //    - Ban oluÅŸturma ve gÃ¼ncelleme Cloud Functions tarafÄ±ndan yapÄ±lÄ±r
    //    - KullanÄ±cÄ±lar ban silemez
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /user_bans/{userId} {
      // ğŸ“– OKUMA: Sadece kullanÄ±cÄ± kendi ban durumunu okuyabilir
      allow read: if isAuthenticated() && isOwner(userId);

      // âœï¸ OLUÅTURMA/GÃœNCELLEME/SÄ°LME: Sadece Cloud Functions (manual DB yÃ¶netimi iÃ§in)
      allow write: if false; // Sadece admin manuel olarak DB'den yapabilir
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š BÃ–LÃœM 12: ANALYTICS (ANALYTICS COLLECTION)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Premium analytics ve gÃ¼nlÃ¼k kullanÄ±m istatistikleri
    //
    // ğŸ”’ GÃ¼venlik PolitikasÄ±:
    //    - HiÃ§ kimse okuyamaz (sadece admin/dashboard iÃ§in)
    //    - Yazma iÅŸlemleri Cloud Functions veya manual DB yÃ¶netimi ile yapÄ±lÄ±r
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    match /analytics/{doc} {
      // HiÃ§ kimse okuyamaz - sadece backend/admin
      allow read: if false;
      allow write: if false; // Sadece Cloud Functions veya manuel DB
    }

    match /daily_analytics/{date} {
      // HiÃ§ kimse okuyamaz - sadece backend/admin
      allow read: if false;
      allow write: if false; // Sadece Cloud Functions veya manuel DB
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸš« BÃ–LÃœM 13: VARSAYILAN REDDETME KURALI
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // YukarÄ±da belirtilmeyen tÃ¼m koleksiyonlara eriÅŸim varsayÄ±lan olarak
    // engellenmiÅŸtir. Bu, gÃ¼venliÄŸi artÄ±rÄ±r ve yanlÄ±ÅŸlÄ±kla veri sÄ±zÄ±ntÄ±sÄ±nÄ±
    // Ã¶nler.
    //
    // âš ï¸  DÄ°KKAT: Yeni bir koleksiyon eklerseniz, yukarÄ±ya Ã¶zel kurallar
    //             eklemelisiniz. Aksi takdirde hiÃ§ kimse eriÅŸemez!
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // TÃ¼m diÄŸer yollar iÃ§in varsayÄ±lan red (deny all)
    // Bu satÄ±r gÃ¼venlik iÃ§in kritiktir!
  }
}


/*
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          ğŸ“ NOTLAR VE BEST PRACTICES                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. ğŸ§ª TEST ETME:
   - Firebase Console'dan rules test aracÄ±nÄ± kullanÄ±n
   - FarklÄ± senaryolarÄ± test edin (owner, badi, yabancÄ± kullanÄ±cÄ±)
   - Her permission kombinasyonunu test edin

2. ğŸ” LOGGING:
   - Firebase Console > Firestore > Rules bÃ¶lÃ¼mÃ¼nden kural ihlallerini izleyin
   - Denied requests loglarÄ± kontrol edin

3. âš¡ PERFORMANS:
   - exists() ve get() Ã§aÄŸrÄ±larÄ± maliyetlidir, dikkatli kullanÄ±n
   - Her request maksimum 20 get/exists Ã§aÄŸrÄ±sÄ± yapabilir
   - Ã‡ok fazla iÃ§ iÃ§e kontrol yapmaktan kaÃ§Ä±nÄ±n

4. ğŸ”’ GÃœVENLÄ°K:
   - Asla client-side validation'a gÃ¼venmeyin
   - Her field iÃ§in validation yapÄ±n
   - Immutable alanlarÄ± kontrol edin (userId gibi)
   - String injection'a karÅŸÄ± dikkatli olun

5. ğŸš€ DEPLOYMENT:
   - Rules deÄŸiÅŸikliklerini test ortamÄ±nda test edin
   - Production'a deploy etmeden Ã¶nce peer review yapÄ±n
   - DeÄŸiÅŸiklikleri git'e commit edin
   - Firebase CLI ile deploy: firebase deploy --only firestore:rules

6. ğŸ“Š MONÄ°TORÄ°NG:
   - Kural ihlallerini dÃ¼zenli kontrol edin
   - Unexpected behavior iÃ§in alerts kurun
   - Usage metrics'i izleyin

7. ğŸ”„ BAKIM:
   - Yeni Ã¶zellik eklendiÄŸinde rules'u gÃ¼ncelleyin
   - Deprecated collection'larÄ± temizleyin
   - DÃ¼zenli olarak security audit yapÄ±n

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Son GÃ¼ncelleme: 2025-11-20
Versiyon: 2.2.0 (User Stats KurallarÄ± Eklendi)
GeliÅŸtirici: Dozi Security Team
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*/
